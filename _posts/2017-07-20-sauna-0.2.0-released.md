---
layout: post
title: "Sauna 0.2.0 released"
title-short: Sauna 0.2.0
tags: [sauna, decision, decisioning, commands, kinesis, hipchat, slack, pagerduty, sendgrid, snowplow]
author: Rostyslav
category: Releases
---

We are excited to announce a new release of [Sauna][sauna], Snowplow's open-source decisioning and response platform. [Version 0.2.0][0.2.0-tag] is centered around real-time decisioning, including a command processing system as well as several new observers and responders that support a real-time pipeline.

This release post will cover the following features:

1. [Real-time command processing](/blog/2017/07/20/sauna-0.2.0-released/#commands)
2. [Amazon Kinesis observer](/blog/2017/07/20/sauna-0.2.0-released/#kinesis)
3. [Real-time responders](/blog/2017/07/20/sauna-0.2.0-released/#responders)
4. [Contributing](/blog/2017/07/20/sauna-0.2.0-released/#contributing)

<!--more-->

<h2 id="commands">1. Real-time command processing</h2>

_TBD - a high-level description of RT architecture._

Sauna commands utilise Snowplow's [self-describing JSON] [self-describing-json] format. Each command is a self-describing JSON, which itself contains two self-describing JSONs - `envelope` and `command`:

{% highlight json %}
{
  "schema": "iglu:com.snowplowanalytics.sauna.commands/command/jsonschema/1-0-0",
  "data": {
    "envelope": {
      "schema": "iglu:com.snowplowanalytics.sauna.commands/envelope/jsonschema/1-0-0",
      "data": {
        ...
      }
    },
    "command": {
      "schema": "iglu:com.acme.sauna.commands/action/jsonschema/1-0-0",
      "data": {
        ...
      }
    }
  }
}
{% endhighlight %}

In the command declared above the `envelope` identifies the command and provides instructions on how to execute it. The properties within the `envelope` are as follows:

* `commandId` - a [Type-4 UUID] [uuid] uniquely identifying a command.
* `whenCreated` - a [ISO 8601 timestamp] [iso8601] tracking when the command was created.
* `execution.semantics` - controls how the command should be executed. Currently the only option here is `AT_LEAST_ONCE`, meaning that the command will be actioned at least once (but potentially multiple times).
* `execution.timeToLive` - the lifetime of the command (in milliseconds). If the time at which Sauna processes a command is greater than `whenCreated` plus `timeToLive`, the command is discarded.
* `tags` - a way of attaching unstructured metadata to a given command that will be utilised in future versions of Sauna.

`command` specifies the exact action to execute and contains data that will be forwarded to responders. At least one Sauna responder should be configured to action a specific command.

More information on Sauna commands can be found in the [Commands for Analylists] [commands-for-analysts] guide.

<h2 id="kinesis">2. Amazon Kinesis observer</h2>

This observer added in Sauna 0.2.0 monitors an [Amazon Kinesis] [kinesis] stream for arriving records. Each record is then processed as a Sauna command, which can trigger corresponding real-time responders.

The observer is configured by a self-describing Avro file which validates against the [com.snowplowanalytics.sauna.observers/AmazonKinesisConfig/avro/1-0-0] [kinesis-iglu] Iglu schema. The configuration file should include several required credentials (AWS access keys, stream identifier) as well as optional configuration options that allow you to configure the observer's behaviour while processing streams.

Under the hood, the Amazon Kinesis Observer implements a [Kinesis Client Library] [kcl] stream consumer to simplify processing of a Kinesis stream's records across all shards.

Details on setting up the Kinesis observer can be found in [the Amazon Kinesis Observer setup guide] [kinesis-setup-guide]. Many thanks to [Cory Finger] [fingerco] for contributing the Amazon Kinesis observer!

<h2 id="hipchat">3. Real-time responders</h2>

Sauna 0.2.0 adds several *real-time responders*, triggered by well-structured JSON commands being received by a compatible real-time observer.

The first of these responders allows you to use Sauna with the [HipChat] [hipchat] enterprise messaging platform. This Sauna responder has a single *action*, which lets you process a valid "send room notification" command and, if successful, send the enclosed data as a notification to a HipChat room using the platform's [v2 API] [hipchat-api-v2].

For more information on the HipChat Responder, please check out:

* [The Hipchat Responder setup guide] [hipchat-setup-guide], for devops
* [The Hipchat Responder usage guide] [hipchat-user-guide], for analysts

A similar responder integrates Sauna with another enterprise messaging platform, [Slack] [slack]. The responder allows you to send messages to Slack rooms or users and supports Slack attachments - optional footers containing richly formatted text, links and images.

For more information on the Slack Responder, please check out:

* [The Slack Responder setup guide] [slack-setup-guide], for devops
* [The Slack Responder usage guide] [slack-user-guide], for analysts

The third real-time responder added in 0.2.0 adds support for the [PagerDuty] [pagerduty] incident resolution system. This responder action lets you send an *event* using the [PagerDuty event format] [pagerduty-event-format]. These events have three different types:

* `trigger` - either opens a new incident or adds a new log entry to an existing incident.
* `acknowledge` - marks an incident as acknowledged, preventing it from generating additional notifications.
* `resolve` - marks an incident as resolved.

This allows the responder to either report a new problem to PagerDuty, notify the platform that a problem is being worked on, or mark a problem as fixed.

Additional information about the PagerDuty Responder can be found in:

* [The PagerDuty Responder setup guide] [pagerduty-setup-guide], for devops
* [The PagerDuty Responder usage guide] [pagerduty-user-guide], for analysts

Finally, Sauna 0.2.0 adds an additional action to the existing [SendGrid] [sendgrid] observer. This action allows you to send email to the recipients using [SendGrid's Web API v3] [sendgrid-web-api-v3]. This is a particularly feature-rich command - a guide to the available data parameters can be found on [SendGrid's API documentation website] [sendgrid-body-parameters].

As usual, more information about the responder is located in:

* [The SendGrid Responder setup guide] [sendgrid-setup-guide], for devops
* [The SendGrid Responder usage guide ("Send email (real-time)" section)] [sendgrid-user-guide], for analysts

<h2 id="docs">4. Contributing</h2>

_TBD - I'm not sure if this should be oriented towards support (please go to Discourse) or contributing (please go to GitHub)? Probably the latter since Sauna's not 1.0.0 yet._

[sauna]: https://github.com/snowplow/sauna
[0.2.0-tag]: https://github.com/snowplow/sauna/releases/tag/0.2.0

[self-describing-json]: https://snowplowanalytics.com/blog/2014/05/15/introducing-self-describing-jsons/
[uuid]: https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_.28random.29
[iso8601]: https://en.wikipedia.org/wiki/ISO_8601#Times
[commands-for-analysts]: https://github.com/snowplow/sauna/wiki/Commands-for-analysts

[kinesis]: https://aws.amazon.com/kinesis/streams/
[kinesis-iglu]: https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.sauna.observers/AmazonKinesisConfig/avro/1-0-0
[kcl]: http://docs.aws.amazon.com/streams/latest/dev/developing-consumers-with-kcl.html
[kinesis-setup-guide]: https://github.com/snowplow/sauna/wiki/Amazon-Kinesis-Observer-setup-guide
[fingerco]: https://github.com/fingerco

[hipchat]: https://hipchat.com/
[hipchat-api-v2]: https://www.hipchat.com/docs/apiv2
[hipchat-setup-guide]: https://github.com/snowplow/sauna/wiki/HipChat-Responder-setup-guide
[hipchat-user-guide]: https://github.com/snowplow/sauna/wiki/HipChat-Responder-user-guide

[slack]: https://slack.com/
[slack-setup-guide]: https://github.com/snowplow/sauna/wiki/Slack-Responder-setup-guide
[slack-user-guide]: https://github.com/snowplow/sauna/wiki/Slack-Responder-user-guide

[pagerduty]: https://www.pagerduty.com/
[pagerduty-event-format]: https://v2.developer.pagerduty.com/v2/docs/trigger-events
[pagerduty-setup-guide]: https://github.com/snowplow/sauna/wiki/PagerDuty-Responder-setup-guide
[pagerduty-user-guide]: https://github.com/snowplow/sauna/wiki/PagerDuty-Responder-user-guide

[sendgrid]: https://sendgrid.com/
[sendgrid-web-api-v3]: https://sendgrid.com/docs/API_Reference/Web_API_v3/index.html
[sendgrid-body-parameters]: https://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/index.html#-Request-Body-Parameters
[sendgrid-setup-guide]: https://github.com/snowplow/sauna/wiki/SendGrid-Responder-setup-guide
[sendgrid-user-guide]: https://github.com/snowplow/sauna/wiki/SendGrid-Responder-user-guide#send-email
